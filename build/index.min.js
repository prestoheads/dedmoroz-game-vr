if(b4w.module_check("game_config"))throw"Failed to register module: game_config";
b4w.register("game_config",function(b,a){var y=a("physics"),w=a("quat"),e=a("vec3");b.SCORE=0;b.ROT_SPEED_H=2;b.ROT_SPEED_V=2;b.FLY_VELOCITY=3;b.CAM_OFFSET=new Float32Array([0,0,0]);b.CAM_SOFTNESS=.8;b.TRAIN_DEF_POS=new Float32Array([0,0,0]);b.TRAIN_DEF_ROT=new Float32Array([0,0,0,1]);b.TUNNEL_MAX_DIST=2;b.TUNNEL_FORCE_CLIP=[2,1,1.2];b.ROTATION_CLIP_H=.5;b.ROTATION_CLIP_V=.45;b.ROTATION_CLIP_H=.5*Math.PI;b.ROTATION_CLIP_V=.5*Math.PI;b.ZERO_ROTATION=.001;b.FIX_ROTATION=.5;b.BEFORE_FIX_ROTATION=.25;
b.CM_FLY=y.CM_FLY;b.TS_NOT_STARTED=0;b.TS_JUST_STARTED=1;b.TS_MOVE_IN=2;b.TS_BOUNDS_IN=3;b.TS_BOUNDS_OUT=4;b.TS_BOUNDS_FAR_OUT=5;b.PRESENTS_CTREATE_OFFSET=10;b.PRESENTS_BETWEEN=1;b.PRESENTS_SERIES=10;b.PRESENTS_CTREATE_WIDTH_H=5;b.PRESENTS_CTREATE_WIDTH_V=2;b.PRESENTS_IMPACT_OFFSET=7.75;b.PRESENTS_REMOVE_OFFSET=-10;b.BATS_TO_USE=3;b.BAT_CTREATE_OFFSET=10;b.BAT_BETWEEN=10;b.BAT_INC_FACTOR=10;b.BAT_CTREATE_WIDTH_H=5;b.BAT_CTREATE_WIDTH_V=2;b.BAT_REMOVE_OFFSET=-10;b.CLOUDS_DEF_POS=new Float32Array([0,
0,0]);b.CLOUDS_MAX_NUMBER_FACTOR=1;b.EARTH_OFFSET=new Float32Array([0,0,-10]);b.MOUSE_SHARPEN_FACTOR=1;b.MOUSE_OFF_LIMIT=1;b.TOUCHE_SHARPEN_FACTOR=1.5;b.TOUCHE_CENTER_OFFSET=[.25,0];b.MOUSE_OFFSET_ZERO=[0,0];b.HMD_POS_INIT_OFFSET=e.fromValues(0,0,0);b.HMD_POS_SHARPEN_FACTOR=1;b.HMD_ROT_INIT_OFFSET=w.create();w.rotateZ(w.fromValues(0,0,0,1),Math.PI,b.HMD_ROT_INIT_OFFSET);b.CONTROLLER_SHARPEN_FACTOR=.5});if(b4w.module_check("train"))throw"Failed to register module: train";
b4w.register("train",function(b,a){function y(a){h.set_character_move_type(g.p_body,g.move_type);a=[a];var b=1,A=0,B=new Float32Array([0,0,0]),d=q.get_mouse_location(),x=new Float32Array([0,0,0]),c;window.game_go=!0;e.create_sensor_manifold(g.p_body,"MOVE",e.CT_CONTINUOUS,a,function(a){return a[0]},function(a,p){c=e.get_sensor_value(a,p,0);window.game_go&&h.set_character_move_dir(a,1,0);k.get_translation(a,g.translation);k.get_rotation(a,g.rotation);h.set_character_vert_move_dir_angle(a,g.rotation[0]);
u.set_world_position(g.translation[1]);l.copy(g.translation,r);r[0]=0;r[2]=0;A=l.distance(g.translation,r);A>f.TUNNEL_MAX_DIST&&(b=(A-f.TUNNEL_MAX_DIST)/f.TUNNEL_MAX_DIST,B[0]=10*-g.translation[0]*Math.pow(b,5),B[1]=5*-f.FLY_VELOCITY*Math.pow(b,5),B[2]=10*-g.translation[2]*Math.pow(b,5),h.apply_force_world(a,B[0],B[1],B[2]));0<g.after_rotaion&&(g.after_rotaion-=c,0>g.after_rotaion&&(g.after_rotaion=0,d.location_normal=[0,0]));0<=g.after_rotaion&&(x[2]=-f.ROTATION_CLIP_H*d.location_normal[0],x[0]=
f.ROTATION_CLIP_V*d.location_normal[1],Math.abs(x[2]-g.rotation[2])>f.ZERO_ROTATION&&h.character_rotation_inc(a,3*c*f.ROT_SPEED_H*(x[2]-g.rotation[2]),0),Math.abs(x[0]-g.rotation[0])>f.ZERO_ROTATION&&h.character_rotation_inc(a,0,3*c*f.ROT_SPEED_V*(x[0]-g.rotation[0])))})}function w(a,c,A,B,d){function x(a,A,d){b._need_hide_help&&(b._need_hide_help=!1,q.hide_start_mouse_element(1));t=e.get_sensor_value(a,A,12);if(1==d){switch(A){case "LEFT":g.rotation[2]<f.ROTATION_CLIP_H&&h.character_rotation_inc(a,
t*f.ROT_SPEED_H,0);break;case "RIGHT":g.rotation[2]>-f.ROTATION_CLIP_H&&h.character_rotation_inc(a,-t*f.ROT_SPEED_H,0);break;case "UP":g.rotation[0]>-f.ROTATION_CLIP_V&&h.character_rotation_inc(a,0,-t*f.ROT_SPEED_V);break;case "DOWN":g.rotation[0]<f.ROTATION_CLIP_V&&h.character_rotation_inc(a,0,t*f.ROT_SPEED_V)}g.after_rotaion=f.BEFORE_FIX_ROTATION}}var p=e.create_keyboard_sensor(e.KEY_A),k=e.create_keyboard_sensor(e.KEY_LEFT),m=e.create_keyboard_sensor(e.KEY_D),n=e.create_keyboard_sensor(e.KEY_RIGHT),
l=e.create_keyboard_sensor(e.KEY_W),r=e.create_keyboard_sensor(e.KEY_UP),v=e.create_keyboard_sensor(e.KEY_S),u=e.create_keyboard_sensor(e.KEY_DOWN);a=[p,k,a,m,n,c,l,r,A,v,u,B,d];var t=null;document.getElementById("start_mouse");e.create_sensor_manifold(g.p_body,"LEFT",e.CT_CONTINUOUS,a,function(a){return a[0]||a[1]||a[2]},x);e.create_sensor_manifold(g.p_body,"RIGHT",e.CT_CONTINUOUS,a,function(a){return a[3]||a[4]||a[5]},x);e.create_sensor_manifold(g.p_body,"UP",e.CT_CONTINUOUS,a,function(a){return a[6]||
a[7]||a[8]},x);e.create_sensor_manifold(g.p_body,"DOWN",e.CT_CONTINUOUS,a,function(a){return a[9]||a[10]||a[11]},x)}var e=a("controls"),h=a("physics");a("constraints");var t=a("scenes"),k=a("transform");a("camera");var l=a("vec3");a("vec4");a("quat");a("util");var v=a("material"),f=a("game_config"),u=a("environment"),q=a("interface"),g=null,n=null;new Float32Array(2);var r=new Float32Array(3);new Float32Array(3);new Float32Array(3);new Float32Array(4);var c=0,m=3;b._need_hide_help=!1;b.init_wrapper=
function(){g={p_body:t.get_first_character(),body:t.get_object_by_name("train_body"),move_type:f.CM_FLY,fly_velocity:f.FLY_VELOCITY,translation:l.create(),rotation:f.TRAIN_DEF_ROT,score:f.SCORE,state:f.TS_JUST_STARTED,force_to_stabilise_h:null,force_to_stabilise_v:null,distance_to_stabilise:null,after_rotaion:0,obj_last_collide_name:""};n={body:t.get_object_by_name("wagon_01"),offset:new Float32Array([0,0]),rotation:new Float32Array([0,0,0,1])}};b.setup_controls=function(a){h.set_character_fly_velocity(g.p_body,
g.fly_velocity);var b=e.create_custom_sensor(0),A=e.create_custom_sensor(0),c=e.create_custom_sensor(0),d=e.create_custom_sensor(0);w(b,A,c,d,a);y(a);window.pink&&(v.set_nodemat_value(g.body,["SteamengineMaterial","SteamEnginePink"],1),v.set_nodemat_value(n.body,["WagonMaterial","WagonPinkValue"],1))};b.setup_collector_score=function(a){var b=[e.create_collision_sensor(a,"SCORE")],A=document.getElementById("points"),B=document.getElementById("trains"),d=l.create();k.get_translation(a,d);var x=t.get_object_name(a);
e.create_sensor_manifold(a,"PRESENT",e.CT_TRIGGER,b,function(a){return a[0]},function(a,b,e){x!=g.obj_last_collide_name&&(g.obj_last_collide_name=x,d[1]+=f.PRESENTS_IMPACT_OFFSET,k.set_translation_v(a,d),window.move_dummy&&window.move_dummy(x,d),"b"==x.substring(0,1)?(m--,0<=m&&(B.className="t-"+m,0==m&&window.game_over&&window.game_over(c))):(c++,A.innerHTML=c,window.game_score=c))})};b.reset=function(){};b.get_wrapper=function(){return g}});if(b4w.module_check("environment"))throw"Failed to register module: environment";
b4w.register("environment",function(b,a){var y=a("controls"),w=a("scenes"),e=a("transform");a("material");var h=a("game_config"),t=a("train");a("interface");var k=null,l=null;b.setup_land=function(a){l={_world_land:w.get_object_by_name("LandSurfaceOffsetEmpty"),_world_sky:w.get_object_by_name("SkyEmpty"),_animate_x:w.get_object_by_name("LandAnimateX"),_animate_y:w.get_object_by_name("LandAnimateY"),rotation_x:0,rotation_y:0,position_y:0};new Float32Array(4);new Float32Array(4);var b=new Float32Array(3);
t.get_wrapper();y.create_sensor_manifold(null,"LAND_ROTATE",y.CT_CONTINUOUS,[a],null,function(a,f){y.get_sensor_value(a,f,0);b=[0,l.position_y,0];e.set_translation_v(l._world_land,b);e.set_translation_v(l._world_sky,b)})};b.setup_clouds=function(a){k={empty:w.get_object_by_name("CloudEmittersEmpty"),emitters:[],position:h.CLOUDS_DEF_POS,number_factor:h.CLOUDS_MAX_NUMBER_FACTOR};var b=k.position[1],l=t.get_wrapper();y.create_sensor_manifold(null,"CLOUDS_MOVE",y.CT_CONTINUOUS,[a],null,function(a,g){b=
l.translation[1];k.position[1]=b;e.set_translation_v(k.empty,k.position)})};b.set_land_rotation=function(a,b){};b.set_world_position=function(a){l.position_y=a}});if(b4w.module_check("interface"))throw"Failed to register module: interface";
b4w.register("interface",function(b,a){function y(a,b){m=[c.canvas_dims[0]/2,c.canvas_dims[1]/2];c.location_normal[0]=2*(a[0]-m[0])/Math.min(c.canvas_dims[0],c.canvas_dims[1]);c.location_normal[1]=2*(a[1]-m[1])/Math.min(c.canvas_dims[0],c.canvas_dims[1]);c.location_normal[0]*=b;c.location_normal[1]*=b;Math.abs(c.location_normal[0])>n.MOUSE_OFF_LIMIT||Math.abs(c.location_normal[1])>n.MOUSE_OFF_LIMIT?(c.location_normal[0]=0,c.location_normal[1]=0):(.5<c.location_normal[0]?c.location_normal[0]=.5:-.5>
c.location_normal[0]&&(c.location_normal[0]=-.5),.5<c.location_normal[1]?c.location_normal[1]=.5:-.5>c.location_normal[1]&&(c.location_normal[1]=-.5),c.location_normal[0]*=2,c.location_normal[1]*=2,c.location_normal[0]+=n.MOUSE_OFFSET_ZERO[0],c.location_normal[1]+=n.MOUSE_OFFSET_ZERO[1])}function w(a,b){function d(d,A,x){d=c-k.get_timeline();0>d?t.remove_sensor_manifold(null,"SHOW_"+a.id):a.style.opacity=1-d/b}b=b||0;a.style.opacity=0;a.style.visibility="visible";var c=k.get_timeline()+b;if(!t.check_sensor_manifold(null,
"SHOW_"+a.id)){var A=t.create_elapsed_sensor();t.create_sensor_manifold(null,"SHOW_"+a.id,t.CT_CONTINUOUS,[A],null,d)}}function e(a,b){function d(d,x,e){d=g-k.get_timeline();0>d?(a.style.visibility="hidden",t.remove_sensor_manifold(null,"HIDE_"+a.id)):a.style.opacity=d/b*c}b=b||0;var c=a.style.opacity,g=k.get_timeline()+b;if(!t.check_sensor_manifold(null,"HIDE_"+a.id)){var e=t.create_elapsed_sensor();t.create_sensor_manifold(null,"HIDE_"+a.id,t.CT_CONTINUOUS,[e],null,d)}}var h=a("transform"),t=a("controls"),
k=a("time");a("mouse");var l=a("input"),v=a("container"),f=a("quat"),u=a("vec3"),q=a("scenes"),g=a("util"),n=a("game_config"),r=a("train");a("environment");var c=null,m=[0,0],p=u.create(),z=f.create();b.init=function(){c={location_normal:[0,0],canvas:v.get_canvas(),canvas_dims:null,arrow_sensors:null};c.canvas_dims=[c.canvas.clientWidth,c.canvas.clientHeight];window.onresize=function(){c.canvas_dims=[c.canvas.clientWidth,c.canvas.clientHeight]}};b.setup_arrow_sensors=function(a,b,d,x){c.arrow_sensors=
[a,b,d,x]};b.get_mouse_location=function(){return c};b.setup_mouse_controls=function(){r.get_wrapper();var a=l.get_device_by_type_element(l.DEVICE_MOUSE);l.attach_param_cb(a,l.MOUSE_LOCATION,function(a){y(a,n.MOUSE_SHARPEN_FACTOR)})};b.setup_controller_controls=function(a){var b=[0,0];q.get_object_by_name("ControllerCube1");var d=q.get_object_by_name("ControllerCube2");t.create_sensor_manifold(d,"CONTROLLER_2_MOVE",t.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,d){h.get_rotation(a,z);f.rotateX(z,
-Math.PI/2,z);g.quat_to_euler(z,p);b[0]=g.rad_to_deg(p[2]);b[1]=-g.rad_to_deg(p[0]);m=b;c.location_normal[0]=-m[0]*n.CONTROLLER_SHARPEN_FACTOR/90;c.location_normal[1]=m[1]*n.CONTROLLER_SHARPEN_FACTOR/90})};b.setup_touch_controls=function(){r.get_wrapper();var a=[0,0],b=[0,0];document.getElementById("controls").addEventListener("touchstart",function(b){b.preventDefault();b=b.changedTouches;for(var c=0;c<b.length;++c)a[0]=b[c].clientX,a[1]=b[c].clientY},!1);document.getElementById("controls").addEventListener("touchmove",
function(d){d.preventDefault();d=d.changedTouches;for(var e=0;e<d.length;++e)b[0]=d[e].clientX-a[0]+c.canvas_dims[0]*(.5+n.TOUCHE_CENTER_OFFSET[0]),b[1]=d[e].clientY-a[1]+c.canvas_dims[1]*(.5+n.TOUCHE_CENTER_OFFSET[1]),m=b,m[0]-=c.canvas_dims[0]*n.TOUCHE_CENTER_OFFSET[0],m[1]-=c.canvas_dims[1]*n.TOUCHE_CENTER_OFFSET[1],y(m,n.TOUCHE_SHARPEN_FACTOR);r.get_wrapper().after_rotaion=n.BEFORE_FIX_ROTATION},!1);document.getElementById("controls").addEventListener("touchend",function(a){a.preventDefault()},
!1)};b.update_score=function(){score=r.get_wrapper().score;document.getElementById("score").innerHTML=_score};b.show_controls_element=function(a){var b=document.getElementById("controls");w(b,a)};b.hide_controls_element=function(a){var b=document.getElementById("controls");e(b,a)};b.show_start_mouse_element=function(a){var c=document.getElementById("start_mouse"),d=c.getElementsByTagName("img")[0];w(c,a);d.onmouseover=function(a){b.setup_mouse_controls();e(c,1)}};b.hide_start_mouse_element=function(a){var b=
document.getElementById("start_mouse");e(b,a)}});if(b4w.module_check("presents"))throw"Failed to register module: presents";
b4w.register("presents",function(b,a){function y(){var a=f;u++;u>=q&&(u%=q);return a[u]}var w=a("transform"),e=a("controls"),h=a("scenes"),t=a("objects"),k=a("game_config");a("game_main");var l=a("train"),v=[],f=[],u=-1,q=null,g=null,n=null,r=0,c=0,m=0,p=[],z=new Float32Array(3);b.init=function(a){v[0]=h.get_object_by_name("PresentBlue");v[1]=h.get_object_by_name("PresentGreen");v[2]=h.get_object_by_name("PresentOrange");f=[.3793458374339087,.3248122616842415,.19378927296200876,.22424078426137717,
.059703112159235516,.6873645935894619,.5552481230672832,.41937630872128406,.3328914017916229,.821689231664338];q=f.length};b.setup_presents_generation=function(a){g=l.get_wrapper().translation;window._presents_generation_marker=g;var b=0,d=0;e.create_sensor_manifold(null,"GENERATE_PRESENTS",e.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,f){e.get_sensor_value(a,f,0);d=g[1]-k.PRESENTS_CTREATE_OFFSET;if(d<b-k.PRESENTS_BETWEEN){b=d;m++;0==m%k.PRESENTS_SERIES&&(r=y()*k.PRESENTS_CTREATE_WIDTH_H-
k.PRESENTS_CTREATE_WIDTH_H/2,c=y()*k.PRESENTS_CTREATE_WIDTH_V-k.PRESENTS_CTREATE_WIDTH_V/2);var x=r,A=d,q=c;n=t.copy(v[m%3],"present"+m,!1);h.append_object(n);w.set_translation(n,x,A,q);l.setup_collector_score(n);p.push(n)}w.get_translation(p[0],z);g[1]-z[1]<k.PRESENTS_REMOVE_OFFSET&&(h.check_object_by_name(h.get_object_name(p[0]))&&h.remove_object(p[0]),p[0]=null,delete p[0],p.splice(0,1))})}});if(b4w.module_check("bat"))throw"Failed to register module: presents";
b4w.register("bat",function(b,a){function y(){var a=f;u++;u>=q&&(u%=q);return a[u]}var w=a("transform"),e=a("controls"),h=a("scenes"),t=a("objects"),k=a("game_config");a("game_main");var l=a("train"),v=[],f=[],u=-1,q=null,g=null,n=null,r=0,c=0,m=0,p=[],z=new Float32Array(3);b.init=function(a){v=h.get_object_by_name("bat");f=[.3793458374339087,.3248122616842415,.19378927296200876,.22424078426137717,.059703112159235516,.6873645935894619,.5552481230672832,.41937630872128406,.3328914017916229,.821689231664338];
q=f.length};b.setup_bats_generation=function(a){g=l.get_wrapper().translation;var b=0,d=0;e.create_sensor_manifold(null,"GENERATE_BATS",e.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,f){e.get_sensor_value(a,f,0);d=g[1]-k.BAT_CTREATE_OFFSET;if(d<b-k.BAT_BETWEEN){b=d;m++;r=y()*k.BAT_CTREATE_WIDTH_H-k.BAT_CTREATE_WIDTH_H/2;c=y()*k.BAT_CTREATE_WIDTH_V-k.BAT_CTREATE_WIDTH_V/2;var x=r,A=d,q=c;n=t.copy(v,"bat"+m,!1);h.append_object(n);w.set_translation(n,x,A,q);l.setup_collector_score(n);p.push(n)}0<
p.length&&(w.get_translation(p[0],z),g[1]-z[1]<k.PRESENTS_REMOVE_OFFSET&&(h.check_object_by_name(h.get_object_name(p[0]))&&h.remove_object(p[0]),p[0]=null,delete p[0],p.splice(0,1)))})}});if(b4w.module_check("game_main"))throw"Failed to register module: game_main";
b4w.register("game_main",function(b,a){function y(a,b){b?(m.create_preloader(),a.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1},u.load(O+"ded_moroz_06.json",e,w)):console.log("b4w init failure")}function w(a){m.update_preloader(a)}function e(a,b){if(b){z.check_browser_support()?h():console.log("No VR support detected.");G.init_wrapper();I.init();J.init();D.init();var c=q.create_elapsed_sensor();G.setup_controls(c);var d=r.get_object_by_name("LandAnimateY");g.apply(d,"LandAnimateYAction");
g.play(d);g.set_behavior(d,g.AB_CYCLIC);P.setup_land(c);I.setup_presents_generation(c);J.setup_bats_generation(c);window._objects={};d=r.get_active_camera();l(d,c);d=r.get_object_by_name("character_collider");l(d,c);d=r.get_object_by_name("LandSurfaceOffsetEmpty");l(d,c);d=r.get_object_by_name("LandAnimateY");l(d,c);d=r.get_object_by_name("SkyEmpty");l(d,c);d=r.get_object_by_name("ControllerCube1");l(d,c);d=r.get_object_by_name("ControllerCube2");l(d,c);var d=r.get_active_camera(),e=r.get_object_by_name("camera_target"),
f=r.get_object_by_name("MainCameraCube");n.append_semi_soft(f,e,E.CAM_OFFSET,E.CAM_SOFTNESS);n.append_copy_loc(d,f);v.disable_camera_controls();H?(D.setup_mouse_controls(),D.setup_touch_controls(),D.show_controls_element(1)):(D.show_start_mouse_element(1),G._need_hide_help=!0);D.setup_controller_controls(c)}else console.log("b4w load failure")}function h(){A.update();z.enable_hmd(z.HMD_ALL_AXES_MOUSE_NONE);d.add_click_listener(document.body,function(){B.request_fullscreen_hmd();document.getElementById("main_canvas_container").style.zIndex=
"1";document.getElementById("dummy_canvas_container").style.zIndex="2"});var a=q.create_elapsed_sensor(),b=q.create_hmd_position_sensor();q.create_hmd_quat_sensor();var c=C.create(),e=null,g=r.get_active_camera();q.create_sensor_manifold(g,"HMD_TRANSLATE_CAMERA",q.CT_CONTINUOUS,[a,b],null,function(a,b,d){0<d&&(a=q.get_sensor_payload(a,b,1),K?(e=C.subtract(a,c,M),C.scale(e,E.HMD_POS_SHARPEN_FACTOR,e),C.copy(a,c)):(C.subtract(E.HMD_POS_INIT_OFFSET,a,L),z.set_position(L),z.set_rotate_quat(E.HMD_ROT_INIT_OFFSET),
C.copy(a,c),K=!0))});k()}function t(a,b){var d=q.create_elapsed_sensor();q.create_sensor_manifold(a,"POINTER_CONTROLLER"+b,q.CT_CONTINUOUS,[d],q.default_OR_logic_fun,function(a,b,d){c.get_rotation(a,N)})}function k(){var a=r.get_object_by_name("ControllerCube1"),b=r.get_object_by_name("ControllerCube2");z.enable_controllers(a,b);var c=d.get_vr_controller_id(0),e=d.get_vr_controller_id(1);t(a,"pointer_1",c);t(b,"pointer_2",e)}function l(a,b){var c={obj:a};window._objects[r.get_object_name(a)]=c}var v=
a("app"),f=a("config"),u=a("data"),q=a("controls"),g=a("animation"),n=a("constraints"),r=a("scenes"),c=a("transform"),m=a("preloader"),p=a("version"),z=a("hmd"),A=a("hmd_conf"),B=a("screen"),d=a("input"),x=a("quat"),C=a("vec3"),E=a("game_config"),G=a("train"),P=a("environment"),D=a("interface"),I=a("presents"),J=a("bat"),F="DEBUG"===p.type(),O=f.get_assets_path("ded_moroz_06"),H=!1;C.create();var M=C.create(),N=x.create(),K=!1,L=C.create();b.init=function(){var a=F,b=v.get_url_params();b&&"show_fps"in
b&&(a=!0);H=navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)?!0:!1;v.init({canvas_container_id:"main_canvas_container",callback:y,physics_enabled:!0,show_fps:a,assets_dds_available:!F,assets_pvr_available:!F,assets_min50_available:!F,console_verbose:F,autoresize:!0,alpha:!1,stereo:"HMD"})}});
b4w.require("game_main","game_main").init();if(b4w.module_check("dummy_presents"))throw"Failed to register module: dummy_presents";
b4w.register("dummy_presents",function(b,a){function y(){var a=f;u++;u>=q&&(u%=q);return a[u]}var w=a("transform"),e=a("controls"),h=a("scenes"),t=a("objects"),k=a("vec3"),l=a("game_config");a("game_main");a("train");var v=[],f=[],u=-1,q=null,g=k.create(),n=null,r=0,c=0,m=0,p=[],z=new Float32Array(3);b.init=function(a){v[0]=h.get_object_by_name("PresentBlue");v[1]=h.get_object_by_name("PresentGreen");v[2]=h.get_object_by_name("PresentOrange");f=[.3793458374339087,.3248122616842415,.19378927296200876,
.22424078426137717,.059703112159235516,.6873645935894619,.5552481230672832,.41937630872128406,.3328914017916229,.821689231664338];q=f.length};b.setup_presents_generation=function(a){a=[a];var b=0,d=0;h.get_object_by_name("character_collider");e.create_sensor_manifold(null,"GENERATE_PRESENTS",e.CT_CONTINUOUS,a,function(a){return a[0]},function(a,f){e.get_sensor_value(a,f,0);if(g=window._presents_generation_marker){d=g[1]-l.PRESENTS_CTREATE_OFFSET;if(d<b-l.PRESENTS_BETWEEN){b=d;m++;0==m%l.PRESENTS_SERIES&&
(r=y()*l.PRESENTS_CTREATE_WIDTH_H-l.PRESENTS_CTREATE_WIDTH_H/2,c=y()*l.PRESENTS_CTREATE_WIDTH_V-l.PRESENTS_CTREATE_WIDTH_V/2);var k=r,x=d,q=c;n=t.copy(v[m%3],"present"+m,!1);h.append_object(n);w.set_translation(n,k,x,q);p.push(n)}w.get_translation(p[0],z);g[1]-z[1]<l.PRESENTS_REMOVE_OFFSET&&(h.check_object_by_name(h.get_object_name(p[0]))&&h.remove_object(p[0]),p[0]=null,delete p[0],p.splice(0,1))}})}});if(b4w.module_check("dummy_bat"))throw"Failed to register module: presents";
b4w.register("dummy_bat",function(b,a){function y(){var a=v;f++;f>=u&&(f%=u);return a[f]}var w=a("transform"),e=a("controls"),h=a("scenes"),t=a("objects"),k=a("game_config");a("game_main");a("train");var l=[],v=[],f=-1,u=null,q=null,g=null,n=0,r=0,c=0,m=[],p=new Float32Array(3);b.init=function(a){l=h.get_object_by_name("bat");v=[.3793458374339087,.3248122616842415,.19378927296200876,.22424078426137717,.059703112159235516,.6873645935894619,.5552481230672832,.41937630872128406,.3328914017916229,.821689231664338];
u=v.length};b.setup_bats_generation=function(a){q=window._presents_generation_marker;var b=0,f=0;e.create_sensor_manifold(null,"GENERATE_BATS",e.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,x){e.get_sensor_value(a,x,0);if(q=window._presents_generation_marker){f=q[1]-k.BAT_CTREATE_OFFSET;if(f<b-k.BAT_BETWEEN){b=f;c++;n=y()*k.BAT_CTREATE_WIDTH_H-k.BAT_CTREATE_WIDTH_H/2;r=y()*k.BAT_CTREATE_WIDTH_V-k.BAT_CTREATE_WIDTH_V/2;var d=n,u=f,v=r;g=t.copy(l,"bat"+c,!1);h.append_object(g);w.set_translation(g,
d,u,v);m.push(g)}0<m.length&&(w.get_translation(m[0],p),q[1]-p[1]<k.PRESENTS_REMOVE_OFFSET&&(h.check_object_by_name(h.get_object_name(m[0]))&&h.remove_object(m[0]),m[0]=null,delete m[0],m.splice(0,1)))}})}});if(b4w.module_check("dummy_game_main"))throw"Failed to register module: dummy_game_main";
b4w.register("dummy_game_main",function(b,a){function y(a,b){b?(q.create_preloader(),a.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1},l.load(z+"ded_moroz_06.json",e,w)):console.log("b4w init failure")}function w(a){q.update_preloader(a)}function e(a,b){if(b){c.init();m.init();window.move_dummy=function(a,b){if(f.check_object_by_name(a)){var c=f.get_object_by_name(a);u.set_translation_v(c,b)}};var d=v.create_elapsed_sensor();c.setup_presents_generation(d);m.setup_bats_generation(d);
var e=f.get_active_camera();h(e,"MainCamera",d);e=f.get_object_by_name("character_collider");h(e,"character_collider",d);e=f.get_object_by_name("LandSurfaceOffsetEmpty");h(e,"LandSurfaceOffsetEmpty",d);e=f.get_object_by_name("LandAnimateY");h(e,"LandAnimateY",d);e=f.get_object_by_name("SkyEmpty");h(e,"SkyEmpty",d);e=f.get_object_by_name("ControllerCube1");h(e,"ControllerCube1",d);e=f.get_object_by_name("ControllerCube2");h(e,"ControllerCube2",d)}else console.log("b4w load failure")}function h(a,b,
c){var d=null;v.create_sensor_manifold(a,"DUMMY_FROM_OBJECT_"+b,v.CT_CONTINUOUS,[c],v.default_OR_logic_fun,function(a,c,e){null===d?window._objects&&window._objects[b]&&(d=window._objects[b].obj):f.check_object_by_name(b)&&(u.set_translation_v(a,u.get_translation(d)),u.set_rotation_v(a,u.get_rotation(d)))})}var t=a("app"),k=a("config"),l=a("data"),v=a("controls");a("constraints");var f=a("scenes"),u=a("transform"),q=a("preloader"),g=a("version");a("hmd");a("hmd_conf");a("screen");a("input");var n=
a("vec3"),r=a("quat");a("game_config");a("train");a("environment");a("interface");var c=a("dummy_presents"),m=a("dummy_bat"),p="DEBUG"===g.type(),z=k.get_assets_path("ded_moroz_06");n.create();n.create();n.create();r.create();n.fromValues(0,0,0);b.init=function(){var a=p,b=t.get_url_params();b&&"show_fps"in b&&(a=!0);navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||
navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i);t.init({canvas_container_id:"dummy_canvas_container",callback:y,physics_enabled:!1,show_fps:a,assets_dds_available:!p,assets_pvr_available:!p,assets_min50_available:!p,console_verbose:p,autoresize:!0,alpha:!1})}});b4w.require("dummy_game_main","dummy_game_main").init();
